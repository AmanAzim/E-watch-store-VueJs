!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ZalgoPromise",[],t):"object"==typeof exports?exports.ZalgoPromise=t():e.ZalgoPromise=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e){try{if(!e)return!1;if("undefined"!=typeof Promise&&e instanceof Promise)return!0;if("undefined"!=typeof window&&window.Window&&e instanceof window.Window)return!1;if("undefined"!=typeof window&&window.constructor&&e instanceof window.constructor)return!1;var t={}.toString;if(t){var r=t.call(e);if("[object Window]"===r||"[object global]"===r||"[object DOMWindow]"===r)return!1}if("function"==typeof e.then)return!0}catch(e){return!1}return!1}Object.defineProperty(t,"__esModule",{value:!0});var o=[],i=[],c=0,u=void 0;function s(){if(!c&&u){var e=u;u=null,e.resolve()}}function f(){c+=1}function a(){c-=1,s()}var l=function(){function e(t){var r=this;if(function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],t){var n=void 0,o=void 0,i=!1,c=!1,u=!1;f();try{t(function(e){u?r.resolve(e):(i=!0,n=e)},function(e){u?r.reject(e):(c=!0,o=e)})}catch(e){return a(),void this.reject(e)}a(),u=!0,i?this.resolve(n):c&&this.reject(o)}}return e.prototype.resolve=function(e){if(this.resolved||this.rejected)return this;if(n(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},e.prototype.reject=function(e){var t=this;if(this.resolved||this.rejected)return this;if(n(e))throw new Error("Can not reject promise with another promise");if(!e){var r=e&&"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);e=new Error("Expected reject to be called with Error, got "+r)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout(function(){t.errorHandled||function(e,t){if(-1===o.indexOf(e)){o.push(e),setTimeout(function(){throw e},1);for(var r=0;r<i.length;r++)i[r](e,t)}}(e,t)},1),this.dispatch(),this},e.prototype.asyncReject=function(e){return this.errorHandled=!0,this.reject(e),this},e.prototype.dispatch=function(){var t=this,r=this.dispatching,o=this.resolved,i=this.rejected,c=this.handlers;if(!r&&(o||i)){this.dispatching=!0,f();for(var u=function(r){var u=c[r],s=u.onSuccess,f=u.onError,a=u.promise,l=void 0;if(o)try{l=s?s(t.value):t.value}catch(e){return a.reject(e),"continue"}else if(i){if(!f)return a.reject(t.error),"continue";try{l=f(t.error)}catch(e){return a.reject(e),"continue"}}l instanceof e&&(l.resolved||l.rejected)?(l.resolved?a.resolve(l.value):a.reject(l.error),l.errorHandled=!0):n(l)?l instanceof e&&(l.resolved||l.rejected)?l.resolved?a.resolve(l.value):a.reject(l.error):l.then(function(e){a.resolve(e)},function(e){a.reject(e)}):a.resolve(l)},s=0;s<c.length;s++)u(s);c.length=0,this.dispatching=!1,a()}},e.prototype.then=function(t,r){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for success handler");if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for error handler");var n=new e;return this.handlers.push({promise:n,onSuccess:t,onError:r}),this.errorHandled=!0,this.dispatch(),n},e.prototype.catch=function(e){return this.then(void 0,e)},e.prototype.finally=function(t){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.finally expected a function");return this.then(function(r){return e.try(t).then(function(){return r})},function(r){return e.try(t).then(function(){throw r})})},e.prototype.timeout=function(e,t){var r=this;if(this.resolved||this.rejected)return this;var n=setTimeout(function(){r.resolved||r.rejected||r.reject(t||new Error("Promise timed out after "+e+"ms"))},e);return this.then(function(e){return clearTimeout(n),e})},e.prototype.toPromise=function(){if("undefined"==typeof Promise)throw new TypeError("Could not find Promise");return Promise.resolve(this)},e.resolve=function(t){return t instanceof e?t:n(t)?new e(function(e,r){return t.then(e,r)}):(new e).resolve(t)},e.reject=function(t){return(new e).reject(t)},e.asyncReject=function(t){return(new e).asyncReject(t)},e.all=function(t){var r=new e,o=t.length,i=[];if(!o)return r.resolve(i),r;for(var c=function(c){var u=t[c];if(u instanceof e){if(u.resolved)return i[c]=u.value,o-=1,"continue"}else if(!n(u))return i[c]=u,o-=1,"continue";e.resolve(u).then(function(e){i[c]=e,0==(o-=1)&&r.resolve(i)},function(e){r.reject(e)})},u=0;u<t.length;u++)c(u);return 0===o&&r.resolve(i),r},e.hash=function(t){var r={};return e.all(Object.keys(t).map(function(n){return e.resolve(t[n]).then(function(e){r[n]=e})})).then(function(){return r})},e.map=function(t,r){return e.all(t.map(r))},e.onPossiblyUnhandledException=function(e){return function(e){return i.push(e),{cancel:function(){i.splice(i.indexOf(e),1)}}}(e)},e.try=function(t,r,n){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.try expected a function");var o=void 0;f();try{o=t.apply(r,n||[])}catch(t){return a(),e.reject(t)}return a(),e.resolve(o)},e.delay=function(t){return new e(function(e){setTimeout(e,t)})},e.isPromise=function(t){return!!(t&&t instanceof e)||n(t)},e.flush=function(){return t=u=u||new e,s(),t;var t},e}();r.d(t,"ZalgoPromise",function(){return l})}])});
//# sourceMappingURL=zalgo-promise.min.js.map